<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Explainer - Understand Any Contract in Plain English</title>
    <meta name="description" content="Free AI-powered contract analysis. Upload your contract and get a simple explanation in seconds. No legal jargon, just plain English.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js for PDF processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Google AdSense (Replace with your publisher ID) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR-PUBLISHER-ID"
            crossorigin="anonymous"></script>
    
    <style>
        .drop-zone {
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            border-color: #2563eb;
            background-color: #eff6ff;
        }
        .analysis-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border-left: 4px solid #e5e7eb;
            background: #f9fafb;
            border-radius: 0 8px 8px 0;
        }
        .analysis-section h2 {
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .analysis-section.red-flags {
            border-left-color: #dc2626;
            background-color: #fef2f2;
        }
        .analysis-section.bottom-line {
            border-left-color: #059669;
            background-color: #f0fdf4;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">Contract Explainer</h1>
                    <span class="ml-2 text-sm text-blue-600 bg-blue-100 px-2 py-1 rounded">AI-Powered</span>
                </div>
                <div class="text-sm text-gray-600">
                    Free • No signup required • Instant results
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Main Content Area -->
            <div class="lg:col-span-3">
                <!-- Upload Section -->
                <div id="uploadSection" class="bg-white rounded-lg shadow-sm border p-8">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">Understand Any Contract in Plain English</h2>
                        <p class="text-gray-600 mb-8 text-lg">Upload your contract and get a simple explanation in 30 seconds</p>
                        
                        <!-- File Upload Zone -->
                        <div id="dropZone" class="drop-zone border-2 border-dashed border-gray-300 rounded-lg p-12 mb-6 hover:border-blue-500 cursor-pointer transition-all">
                            <div class="text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <p class="text-lg font-medium text-gray-900 mb-2">Drop your contract here</p>
                                <p class="text-gray-500 mb-4">or click to browse</p>
                                <p class="text-sm text-gray-400">Supports PDF, Word documents, and text files</p>
                            </div>
                            <input type="file" id="fileInput" class="hidden" accept=".pdf,.doc,.docx,.txt">
                        </div>
                        
                        <div class="text-sm text-gray-500">
                            <p>✅ Free forever • 🔒 Your files are secure • ⚡ Results in seconds</p>
                        </div>
                    </div>
                </div>

                <!-- Processing Section -->
                <div id="processingSection" class="hidden bg-white rounded-lg shadow-sm border p-8">
                    <div class="text-center">
                        <div class="mb-4">
                            <svg class="mx-auto h-16 w-16 text-blue-600 animate-spin" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">Analyzing your contract...</h3>
                        <p class="text-gray-600 mb-6">Our AI is reading through your document and breaking it down into plain English</p>
                        
                        <div id="progressText" class="text-sm text-blue-600 font-medium">
                            Extracting text from document...
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="hidden bg-white rounded-lg shadow-sm border p-8">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-900">Contract Analysis Results</h2>
                            <button id="newAnalysisBtn" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors">
                                Analyze Another Contract
                            </button>
                        </div>
                        <div class="text-sm text-gray-500">
                            <span id="fileName" class="font-medium"></span> • <span id="wordCount"></span> words • Analyzed just now
                        </div>
                    </div>

                    <!-- Analysis Content -->
                    <div id="analysisContent">
                        <!-- AI analysis will appear here -->
                    </div>

                    <!-- Share Section -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <p class="text-sm text-gray-500">Found this helpful? Share it with others!</p>
                            <button id="shareBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Share Results
                            </button>
                        </div>
                    </div>

                    <!-- Disclaimer -->
                    <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p class="text-sm text-yellow-800">
                            <strong>Disclaimer:</strong> This analysis is for informational purposes only and should not be considered legal advice. Always consult with a qualified attorney for legal matters.
                        </p>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="errorSection" class="hidden bg-red-50 border border-red-200 rounded-lg p-6">
                    <div class="text-center">
                        <h3 class="text-lg font-semibold text-red-800 mb-2">Analysis Issue</h3>
                        <p id="errorMessage" class="text-red-600 mb-4"></p>
                        <div class="space-y-2">
                            <button id="retryBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 w-full">
                                Try Again
                            </button>
                            <button id="showWorkaroundBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">
                                Use Alternative Method
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Workaround Section -->
                <div id="workaroundSection" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-4">Alternative Analysis Method</h3>
                    <p class="text-yellow-700 mb-4">Copy the text below and paste it into ChatGPT or Claude for analysis:</p>
                    
                    <div class="bg-white rounded-lg p-4 mb-4">
                        <h4 class="font-semibold mb-2">Your Contract Text:</h4>
                        <textarea id="extractedText" class="w-full h-32 p-3 border rounded-md text-sm" readonly></textarea>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4">
                        <h4 class="font-semibold mb-2">Copy this prompt to ChatGPT/Claude:</h4>
                        <div class="bg-gray-100 p-3 rounded text-sm" id="promptText"></div>
                        <button id="copyPromptBtn" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            Copy Prompt
                        </button>
                    </div>
                    
                    <div class="mt-4">
                        <button id="backBtn" class="text-blue-600 hover:text-blue-800 text-sm">
                            ← Try Different File
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar with Ads -->
            <div class="lg:col-span-1">
                <div class="space-y-6">
                    <!-- Ad Space 1 -->
                    <div class="bg-white rounded-lg shadow-sm border p-4">
                        <div class="text-center">
                            <div class="w-full h-64 bg-gray-100 rounded flex items-center justify-center">
                                <p class="text-gray-500 text-sm">Advertisement<br>(300x250)</p>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">Advertisement</p>
                        </div>
                    </div>

                    <!-- Legal Resources -->
                    <div class="bg-white rounded-lg shadow-sm border p-4">
                        <h3 class="font-semibold text-gray-900 mb-3">Need More Help?</h3>
                        <div class="space-y-3">
                            <a href="https://legalzoom.com" target="_blank" class="block text-sm text-blue-600 hover:text-blue-800">
                                📋 LegalZoom - Legal Services
                            </a>
                            <a href="https://rocketlawyer.com" target="_blank" class="block text-sm text-blue-600 hover:text-blue-800">
                                ⚖️ Rocket Lawyer - Legal Advice  
                            </a>
                            <a href="https://avvo.com" target="_blank" class="block text-sm text-blue-600 hover:text-blue-800">
                                👨‍💼 Avvo - Find a Lawyer
                            </a>
                        </div>
                    </div>

                    <!-- How it Works -->
                    <div class="bg-blue-50 rounded-lg border p-4">
                        <h3 class="font-semibold text-blue-900 mb-3">How It Works</h3>
                        <div class="space-y-2 text-sm text-blue-800">
                            <div class="flex items-start">
                                <span class="text-blue-600 mr-2">1.</span>
                                <span>Upload your contract</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-600 mr-2">2.</span>
                                <span>AI reads and analyzes it</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-600 mr-2">3.</span>
                                <span>Get plain English explanation</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Banner Ad -->
        <div id="bottomBannerAd" class="hidden mt-8">
            <div class="bg-white rounded-lg shadow-sm border p-4">
                <div class="text-center">
                    <div class="w-full h-20 bg-gray-100 rounded flex items-center justify-center">
                        <p class="text-gray-500 text-sm">Advertisement (728x90)</p>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Advertisement</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Initialize PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        // Global variables
        let extractedDocumentText = '';
        let currentFileName = '';

        // DOM elements
        const uploadSection = document.getElementById('uploadSection');
        const processingSection = document.getElementById('processingSection');
        const resultsSection = document.getElementById('resultsSection');
        const errorSection = document.getElementById('errorSection');
        const workaroundSection = document.getElementById('workaroundSection');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const progressText = document.getElementById('progressText');
        const analysisContent = document.getElementById('analysisContent');
        const bottomBannerAd = document.getElementById('bottomBannerAd');

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Contract Explainer loaded');
            
            // File upload handling
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);
            
            // Button handlers
            document.getElementById('newAnalysisBtn').addEventListener('click', resetToUpload);
            document.getElementById('shareBtn').addEventListener('click', shareResults);
            document.getElementById('retryBtn').addEventListener('click', retryAnalysis);
            document.getElementById('showWorkaroundBtn').addEventListener('click', showWorkaround);
            document.getElementById('copyPromptBtn').addEventListener('click', copyPrompt);
            document.getElementById('backBtn').addEventListener('click', resetToUpload);
        });

        // File handling
        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('dragover');
        }

        function handleDragLeave() {
            dropZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                processFile(e.target.files[0]);
            }
        }

        // Main processing function
        async function processFile(file) {
            try {
                // Validate file
                const allowedTypes = ['application/pdf', 'text/plain'];
                if (!allowedTypes.includes(file.type) && !file.name.toLowerCase().endsWith('.pdf')) {
                    showError('Please upload PDF or text files only.');
                    return;
                }

                if (file.size > 16 * 1024 * 1024) {
                    showError('File too large. Please upload files smaller than 16MB.');
                    return;
                }

                currentFileName = file.name;
                showProcessing();
                
                // Extract text
                let text = '';
                if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
                    text = await extractTextFromPDF(file);
                } else {
                    text = await file.text();
                }

                if (!text || text.trim().length < 50) {
                    showError('Could not extract enough text from the document. Please ensure the file contains readable text.');
                    return;
                }

                extractedDocumentText = text;
                updateProgress('Analyzing contract with AI...');

                // Try AI analysis
                try {
                    const analysis = await analyzeWithAI(text);
                    showResults(analysis);
                } catch (apiError) {
                    console.error('AI analysis failed:', apiError);
                    showError('AI analysis service is currently unavailable. Please use the alternative method below.');
                    document.getElementById('showWorkaroundBtn').style.display = 'block';
                }

            } catch (error) {
                console.error('Processing error:', error);
                showError(error.message);
            }
        }

        // PDF text extraction
        async function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const fileReader = new FileReader();
                fileReader.onload = async function() {
                    try {
                        const typedarray = new Uint8Array(this.result);
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        let text = '';
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            const pageText = textContent.items.map(item => item.str).join(' ');
                            text += pageText + '\n\n';
                        }
                        
                        resolve(text.trim());
                    } catch (error) {
                        reject(new Error('Failed to read PDF. The file might be corrupted or password-protected.'));
                    }
                };
                fileReader.onerror = () => reject(new Error('Failed to read file'));
                fileReader.readAsArrayBuffer(file);
            });
        }

        // AI analysis function
        async function analyzeWithAI(contractText) {
            const prompt = `Analyze this contract and explain it in plain English for someone without legal training.

Contract text:
${contractText.substring(0, 4000)}${contractText.length > 4000 ? '...[truncated]' : ''}

Please structure your response with clear sections:

## Contract Type & Purpose
[What type of contract this is and its main purpose]

## Key Sections
[Break down the most important sections in simple terms]

## ⚠️ RED FLAGS
[Highlight any risky, unusual, or potentially problematic clauses]

## BOTTOM LINE
[Should they sign this? What should they negotiate? Key recommendations]

Use clear, friendly language and avoid legal jargon. Focus on what really matters to a non-lawyer.`;

            // This will fail due to CORS, but we'll try
            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer sk-13a9fab59e7e4db5b3960a61a8c4fd9a',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [{"role": "user", "content": prompt}],
                    max_tokens: 2000,
                    temperature: 0.3
                })
            });

            if (!response.ok) {
                throw new Error(`API responded with status ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // UI state management
        function showProcessing() {
            hideAllSections();
            processingSection.classList.remove('hidden');
        }

        function showResults(analysis) {
            hideAllSections();
            resultsSection.classList.remove('hidden');
            resultsSection.classList.add('fade-in');
            bottomBannerAd.classList.remove('hidden');
            
            // Update file info
            document.getElementById('fileName').textContent = currentFileName;
            document.getElementById('wordCount').textContent = extractedDocumentText.split(' ').length;
            
            // Format and display analysis
            const formattedAnalysis = formatAnalysis(analysis);
            analysisContent.innerHTML = formattedAnalysis;
        }

        function showError(message) {
            hideAllSections();
            errorSection.classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function showWorkaround() {
            hideAllSections();
            workaroundSection.classList.remove('hidden');
            
            // Show extracted text
            document.getElementById('extractedText').value = extractedDocumentText.substring(0, 2000) + 
                (extractedDocumentText.length > 2000 ? '\n\n[Text truncated for display...]' : '');
            
            // Create prompt
            const prompt = `Please analyze this contract and explain it in plain English:

"${extractedDocumentText.substring(0, 3000)}${extractedDocumentText.length > 3000 ? '...[truncated]' : ''}"

Structure your response with:
1. Contract Type & Purpose
2. Key Sections Explained  
3. ⚠️ RED FLAGS (risky clauses)
4. BOTTOM LINE (should I sign this?)

Use simple language, avoid legal jargon.`;
            
            document.getElementById('promptText').textContent = prompt;
        }

        function hideAllSections() {
            uploadSection.classList.add('hidden');
            processingSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            errorSection.classList.add('hidden');
            workaroundSection.classList.add('hidden');
            bottomBannerAd.classList.add('hidden');
        }

        function updateProgress(message) {
            progressText.textContent = message;
        }

        // Analysis formatting
        function formatAnalysis(analysisText) {
            let html = analysisText;
            
            // Format sections with proper styling
            html = html.replace(/## Contract Type & Purpose/g, '<div class="analysis-section"><h2>📄 Contract Type & Purpose</h2>');
            html = html.replace(/## Key Sections/g, '</div><div class="analysis-section"><h2>🔍 Key Sections</h2>');
            html = html.replace(/## ⚠️ RED FLAGS/g, '</div><div class="analysis-section red-flags"><h2>⚠️ RED FLAGS</h2>');
            html = html.replace(/## BOTTOM LINE/g, '</div><div class="analysis-section bottom-line"><h2>✅ BOTTOM LINE</h2>');
            
            // Close last section
            html += '</div>';
            
            // Convert line breaks
            html = html.replace(/\n\n/g, '</p><p class="mt-3">');
            html = html.replace(/\n/g, '<br>');
            
            // Add paragraph tags
            if (!html.startsWith('<div')) {
                html = '<p>' + html + '</p>';
            }
            
            return html;
        }

        // Action functions
        function resetToUpload() {
            hideAllSections();
            uploadSection.classList.remove('hidden');
            fileInput.value = '';
            currentFile = null;
            extractedDocumentText = '';
            currentFileName = '';
        }

        function retryAnalysis() {
            if (currentFileName) {
                // Re-trigger file processing
                const fileInput = document.getElementById('fileInput');
                if (fileInput.files.length > 0) {
                    processFile(fileInput.files[0]);
                } else {
                    resetToUpload();
                }
            } else {
                resetToUpload();
            }
        }

        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'Contract Explainer - AI Analysis Results',
                    text: 'I just got my contract explained in plain English using AI! Check out this free tool:',
                    url: window.location.href
                }).catch(err => console.log('Error sharing:', err));
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    const btn = document.getElementById('shareBtn');
                    const originalText = btn.textContent;
                    btn.textContent = 'Link Copied!';
                    btn.classList.add('bg-green-600');
                    btn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('bg-green-600');
                        btn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    alert('Unable to copy link. Please copy the URL manually.');
                });
            }
        }

        function copyPrompt() {
            const prompt = document.getElementById('promptText').textContent;
            navigator.clipboard.writeText(prompt).then(() => {
                const btn = document.getElementById('copyPromptBtn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.add('bg-green-600');
                btn.classList.remove('bg-blue-600');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('bg-green-600');
                    btn.classList.add('bg-blue-600');
                }, 2000);
                
                alert('Prompt copied to clipboard! Paste this into ChatGPT or Claude for analysis.');
            });
        }
    </script>
</body>
</html>